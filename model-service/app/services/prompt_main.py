from typing import List, Dict




def keyword_prompt(full_text: str) -> str:
    return f"""
    너는 금융과 경제에 특화된 전문 키워드 추출 AI야.

    아래 텍스트에서 '금융' 또는 '경제'와 관련된 전문 용어만 쉼표로 구분해서 추출해.
    - 반드시 **금융 또는 경제 관련 용어**만 포함할 것. (예: '금리', '채권', '환율', '방카슈랑스', '여신', '파킹통장', '인플레이션')
    - 일반 단어, 상황 설명, 인물 이름, 지명, 기관명, '책', '정부' 등 **비금융/비경제 단어는 절대 포함하지 말 것.**
    - 해당 단어가 문맥상 중요해 보여도 **금융·경제 용어가 아니면 무조건 제외**.
    - 결과는 **쉼표로 구분된 키워드 리스트**만 출력 (예: '금리, 환율, 인플레이션')
    - 출력 외에 그 어떤 설명도 하지 마.

    입력 텍스트:
    {full_text}
    """

# -----------------------------------------------------------------
# 질문 답변 챗봇

def build_answer_prompt(text: str) -> str:
    """
    검색 결과(context)가 없을 때 LLM이 키워드에 대해 추론 기반 설명을 생성하되,
    출처 불확실성과 사실 여부에 대한 주의 문구를 포함하는 프롬프트.
    """
    return f"""
        사용자 질문: {text}

        현재 해당 질문에 대한 신뢰 가능한 참고 문단(출처 정보)이 제공되지 않았습니다.

        따라서 아래 조건을 지켜 설명해 주세요:

        - 가능한 일반적 지식이나 널리 알려진 개념을 바탕으로 질문에 대여 간결하게 설명해 주세요.
        - 설명은 1~3문장 이내로 요약하되, 출처가 불확실하므로 **"사실이 아닐 수 있습니다" 또는 "일반적인 개념일 뿐이며 정확한 정의는 아닐 수 있습니다"** 같은 문구를 반드시 포함해 주세요.
        - 설명 이외의 다른 안내, 인삿말 없이 출력 형식만 따르세요.
        - 금융 또는 경제 관련 질문이 아닐 경우, "금융 또는 경제 관련 지식에 대한 질문을 해주세요."라는 안내 문구를 출력하세요.

        [출력 형식]  
        사실이 아닐 수 있습니다.
        답변: (간결한 설명 1~3문장)
    """.strip()

def build_answer_rag_prompt(text: str, keyword: str, context: str) -> str:
    """
    사용자의 질문에 대해 금융/경제 키워드와 해당 키워드의 context를 기반으로 간결한 설명과 관련 검색어를 생성하는 프롬프트.
    질문이 금융/경제와 무관할 경우 안내 메시지를 출력한다.
    """
    return f"""
        너는 금융·경제 전문 지식 AI야. 

        다음 사용자 질문을 분석해 해당 질문이 금융 또는 경제 분야와 관련이 있는지 먼저 판단해.

        - 관련이 있다면, 주어진 키워드 '{keyword}'와 참고 문단을 바탕으로 질문에 대해 간결하고 명확하게 1~2문장으로 답변해.
        - 참고 문단이 부족하더라도 최대한 context의 내용을 반영해서 신뢰도 있는 설명을 해줘.
        - 만약 context의 내용 중 금융과 경제 개념 관련이 아니라고 판단이 되면, 해당 내용은 무시해줘.
        - 관련 검색어 3개를 함께 제시해.
        - 모든 출력은 츌력 형식을 따르고, 다른 인사말이나 설명은 하지 마.
        - 만약 질문이 금융/경제 관련이 아니라면 아래의 안내 문구만 출력해:
        "금융 또는 경제 관련 지식에 대한 질문을 해주세요."

        [질문]
        {text}

        [참고 문단]
        {context}

        [출력 형식]
        답변: (간결한 설명 1~2문장)
        관련 검색어: (키워드1, 키워드2, 키워드3)
    """.strip()

def build_answer_llm_prompt(text: str, keyword: str) -> str:
    """
    검색 결과(context)가 없을 때 LLM이 키워드에 대해 추론 기반 설명을 생성하되,
    출처 불확실성과 사실 여부에 대한 주의 문구를 포함하는 프롬프트.
    """
    return f"""
        사용자 질문: {text}

        '{keyword}'는 금융 또는 경제와 관련된 용어입니다. 현재 해당 키워드에 대한 신뢰 가능한 참고 문단(출처 정보)이 제공되지 않았습니다.

        따라서 아래 조건을 지켜 설명해 주세요:

        - 가능한 일반적 지식이나 널리 알려진 개념을 바탕으로 '{keyword}'를 간결하게 설명해 주세요.
        - 설명은 1~3문장 이내로 요약하되, 출처가 불확실하므로 **"사실이 아닐 수 있습니다" 또는 "일반적인 개념일 뿐이며 정확한 정의는 아닐 수 있습니다"** 같은 문구를 반드시 포함해 주세요.
        - 설명 이외의 다른 안내, 인삿말 없이 아래 출력 형식만 따르세요.

        [출력 형식]  
        사실이 아닐 수 있습니다.
        답변: (간결한 설명 1~3문장)
    """.strip()


# -----------------------------------------------------------------
# 뉴스 해설 생성

def build_news_prompt(text: str) -> str:
    """
    뉴스 내용을 금융·경제 관점에서 요약하고, 핵심/관련 키워드를 식별 및 설명하는 프롬프트입니다.
    """
    return f"""
당신은 금융 및 경제 분야에 특화된 뉴스 분석 AI입니다. 아래 뉴스 본문을 읽고 다음 작업을 수행하세요:

### 1. 뉴스 요약
- 뉴스 내용을 금융·경제적 관점에서 2~3문장 이내로 요약하세요.
- 요약에는 시장 동향, 정책 변화, 기업 활동, 소비자 반응 등 경제적 영향이 반영되어야 합니다.

### 2. 키워드 분석 및 개념 설명
- 뉴스 본문에 등장하며 금융·경제적 개념을 담고 있는 용어를 '핵심 키워드'로 선정하고, 각 키워드에 대해 1~2문장으로 정의하세요. 가능하다면 뉴스 문맥을 근거로 포함하세요.
- 뉴스에는 직접 등장하지 않지만, 주제와 관련 깊은 금융·경제 개념이 있다면 '관련 키워드'로 분류하고 역시 1~2문장으로 설명하세요.

※ 모든 개념 설명은 전문적이되 이해하기 쉬운 표현을 사용해야 하며, 경제적 맥락을 반영해야 합니다.  
※ 출력 형식은 출력 형식을 정확히 따르세요. 다른 인사말이나 안내 문구는 포함하지 마세요.

[뉴스 본문]  
{text}

[출력 형식]  
[요약: 뉴스 요약]  
[핵심 키워드1 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
[핵심 키워드2 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
...  
[관련 키워드1 : 간결한 개념 정의 (금융·경제 관점)]  
[관련 키워드2 : 간결한 개념 정의 (금융·경제 관점)]  
...
    """.strip()


def build_news_rag_prompt(text: str, keyword: str, context: str) -> str:
    """
    RAG 데이터를 활용하여 뉴스 내용을 금융·경제 관점에서 요약하고,
    주어진 키워드를 핵심/관련 키워드로 분류한 뒤, context 기반 설명을 덧붙이는 프롬프트입니다.
    """
    return f"""
당신은 금융 및 경제 분야에 특화된 뉴스 분석 AI입니다. 아래 뉴스 본문과 제공된 키워드, 그리고 참고 문단(context)을 바탕으로 다음 작업을 수행하세요:

### 1. 뉴스 요약
- 뉴스 내용을 금융·경제적 관점에서 2~3문장 이내로 요약하세요.
- 요약에는 시장 동향, 정책 변화, 기업 활동, 소비자 반응 등 경제적 영향이 반영되어야 합니다.

### 2. 키워드 분류 및 개념 설명
- 아래 제공된 키워드 목록을 참고하여, 뉴스 본문에 **직접 등장하거나 문맥상 포함된 키워드**는 '핵심 키워드'로 분류하세요.
- 뉴스 본문에는 등장하지 않지만, 주제와 밀접한 관련이 있는 키워드는 '관련 키워드'로 분류하세요.
- 각 키워드에 대해 1~2문장으로 정의하세요.  
  - 정의 시 아래 참고 문단(context)의 내용을 활용하여 개념 설명을 보완하거나 근거로 삼으세요.  
  - context에 키워드 관련 정보가 없다면 일반적인 금융·경제 지식에 기반하여 설명하세요.

※ 모든 설명은 금융·경제 관점에 근거해야 하며, 경제 초심자도 이해할 수 있도록 명확하게 작성하세요.  
※ 출력 형식은 반드시 출력 형식을 따르세요. 다른 인사말이나 설명은 포함하지 마세요.

[뉴스 본문]  
{text}

[제공된 키워드]  
{keyword}

[참고 문단 (context)]  
{context}

[출력 형식]  
[요약: 뉴스 요약]  
[핵심 키워드1 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
[핵심 키워드2 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
...  
[관련 키워드1 : 간결한 개념 정의 (금융·경제 관점)]  
[관련 키워드2 : 간결한 개념 정의 (금융·경제 관점)]  
...
    """.strip()


def build_news_llm_prompt(text: str, keyword: str) -> str:
    """
    뉴스 내용을 금융·경제 관점에서 요약하고, 주어진 키워드를 본문 기반으로 핵심/관련 키워드로 분류하여 개념을 설명하는 프롬프트입니다.
    """
    return f"""
당신은 금융 및 경제 분야에 특화된 뉴스 분석 AI입니다. 아래 뉴스 본문과 제공된 키워드를 바탕으로 다음 작업을 수행하세요:

### 1. 뉴스 요약
- 뉴스 내용을 금융·경제적 관점에서 2~3문장 이내로 요약하세요.
- 요약에는 시장 동향, 정책 변화, 기업 활동, 소비자 반응 등 경제적 영향이 반영되어야 합니다.

### 2. 키워드 분류 및 개념 설명
- 아래 제공된 키워드 목록을 참고하여, 뉴스 본문에 **직접 등장하거나 문맥상 포함된 키워드**는 '핵심 키워드'로 분류하세요.
- 뉴스 본문에는 등장하지 않지만 주제와 밀접한 연관이 있는 키워드는 '관련 키워드'로 분류하세요.
- 각 키워드에 대해 1~2문장으로 간결하고 명확한 정의를 작성하세요. 가능하면 뉴스 문맥에서 유추된 정보나 경제적 맥락을 근거로 설명하세요.

※ 모든 설명은 금융·경제 관점에 근거해야 하며, 경제 초심자도 이해할 수 있도록 명확하게 작성하세요.  
※ 출력 형식은 반드시 출력 형식 따르세요. 다른 인사말이나 설명은 포함하지 마세요.

[뉴스 본문]  
{text}

[제공된 키워드]  
{keyword}

[출력 형식]  
[요약: 뉴스 요약]  
[핵심 키워드1 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
[핵심 키워드2 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
...  
[관련 키워드1 : 간결한 개념 정의 (금융·경제 관점)]  
[관련 키워드2 : 간결한 개념 정의 (금융·경제 관점)]  
...
    """.strip()

# -----------------------------------------------------------------
# 퀴즈 힌트 생성

def build_hint_prompt(full_text: str) -> str:
    """
    핵심 키워드가 없을 때, 문제를 푸는데 도움을 주는 프롬프트.
    """
    return f"""
        너는 금융·경제 전문 지식 AI야.
        아래 문제를 읽고, 문제를 푸는 데 도움이 되는 간단한 힌트를 제공해 줘.
        - 문제를 푸는 데 도움이 되는 간단한 힌트만 제공하고, 다른 인사말이나 설명은 하지 마.
        - 힌트는 1~2문장 이내로 간결하게 작성해 줘.
        - 출력 형식은 출력 형식을 따르도록 해.

        [문제]
        {full_text}
   
        [출력 형식]
        [힌트: (문제를 푸는 데 도움이 되는 간단한 힌트)]

        """.strip()


def build_hint_rag_prompt(text: str, keyword: str, context: str) -> str:
    """
    금융·경제 관련 객관식 문제에 대해, 핵심 키워드와 선택적 참고 문단(context)을 기반으로
    힌트 및 개념 설명을 생성하는 고도화된 프롬프트입니다.
    """
    return f"""
당신은 금융 및 경제 교육에 특화된 전문가 AI입니다. 아래에 주어진 객관식 문제(문제+보기), 핵심 키워드, 그리고 선택적 참고 문단(context)을 참고하여 다음을 수행하세요:

1. 문제를 금융·경제적 관점에서 분석하고, 정답 유추에 도움이 되는 힌트를 2문장 이내로 작성하세요.
   - 힌트는 정답을 직접 제시하지 말고, 관련 개념이나 사고 접근법을 간접적으로 안내하세요.
   - 참고 문단(context)이 금융 또는 경제와 관련이 있을 경우, 반드시 그 내용을 반영하여 힌트를 작성하세요.

2. 제공된 키워드가 문제와 관련이 있고, context가 금융·경제 관련 내용이라면, 해당 키워드 각각에 대해 context를 근거로 1~2문장 이내의 간결한 개념 설명을 작성하세요.

3. 주어진 키워드가 문제와 관련성이 낮거나 context가 금융·경제와 무관하다면, 문제에서 유추할 수 있는 더 적절한 관련 키워드를 새로 식별하고, 그 키워드에 대한 금융·경제 관점의 간결한 개념 설명을 작성하세요.

※ `text`에는 문제와 보기가 함께 포함되어 있으므로 문맥상 구분하여 분석해야 합니다.  
※ `context`는 금융·경제 관련 문서일 수도 있고 아닐 수도 있으며, 관련이 없는 경우에는 사용하지 않아도 됩니다.  
※ 힌트와 설명 모두 금융 또는 경제 지식을 기반으로 작성되어야 하며, 추측이 아닌 근거 기반 설명을 원칙으로 합니다.  
※ 출력은 반드시 출력 형식을 따르세요.

[문제]  
{text}

[참고 문단]  
{context}

[출력 형식]  
[힌트: 문제를 푸는 데 도움이 되는 금융·경제 지식 기반 힌트 (context 기반이 가능한 경우에만 사용)]  
[핵심 키워드1 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
[핵심 키워드2 : 간결한 개념 정의 (가능한 경우 context 근거 포함)]  
...  
[관련 키워드1 : 간결한 개념 정의 (금융·경제 관점)]  
[관련 키워드2 : 간결한 개념 정의 (금융·경제 관점)]  
...
""".strip()



def build_hint_llm_prompt(text: str, keyword: str) -> str:
    """
    금융·경제 관련 객관식 문제에 대해, 핵심 키워드 및 문맥을 기반으로 힌트와 개념 설명을 생성하는 고도화된 프롬프트입니다.
    """
    return f"""
당신은 금융 및 경제 교육에 특화된 전문가 AI입니다. 아래 제시된 객관식 문제(문제+보기)와 핵심 키워드를 참고하여 다음을 수행하세요:

1. 문제를 금융·경제적 관점에서 분석하고, 정답 도출에 도움이 되는 힌트를 2문장 이내로 작성하세요.  
   - 힌트는 정답을 직접 제시하지 말고, 관련 개념이나 사고 접근법을 간접적으로 안내하세요.
2. 제공된 키워드가 문제와 관련이 있다면, 해당 키워드 각각에 대해 금융·경제 관점에서 간결한 개념 설명을 1~2문장으로 작성하세요.
3. 만약 주어진 키워드가 문제와 관련성이 낮다면, 문제로부터 더 적절한 관련 키워드를 식별하고, 그에 대한 간결한 개념 설명을 작성하세요.

※ 문제와 보기는 하나의 문자열(`text`)로 주어지므로, 문맥을 해석해 구분해야 합니다.  
※ 힌트와 키워드 설명은 반드시 금융 또는 경제 지식을 기반으로 작성해야 하며, 단순 상식 수준을 넘어서는 깊이 있는 내용을 반영해야 합니다.  
※ 출력은 반드시 출력 형식을 따르세요.

[문제]  
{text}

[출력 형식]  
[힌트: 문제를 푸는 데 도움이 되는 금융·경제 지식 기반 힌트]  
[핵심 키워드1 : 해당 용어의 간결한 개념 정의 (금융·경제 관점)]  
[핵심 키워드2 : 해당 용어의 간결한 개념 정의 (금융·경제 관점)]  
...  
[관련 키워드1 : 해당 용어의 간결한 개념 정의 (금융·경제 관점)]  
[관련 키워드2 : 해당 용어의 간결한 개념 정의 (금융·경제 관점)]  
...
""".strip()



# def build_hint_llm_prompt(text: str, keyword: str) -> str:
#     """
    
#     """
#     return f"""
# '{keyword}'는 해당 문제에서의 금융 또는 경제와 관련된 핵심 용어입니다.
# 이 키워드에 대해 1문장으로 개념을 설명해 주세요. 결과는 아래 형식으로만 출력하세요:

# [문제]
# {text}


# [출력 형식]
# [힌트: 문제를 푸는 데 도움이 되는 간단한 힌트]
# [핵심 키워드 : 간단한 개념 설명]
# """.strip()

# def build_hint_llm_prompt(text: str, keyword: str) -> str:
#     """
#     금융·경제 문제에 대한 간단한 힌트와 핵심 키워드 설명을 생성하는 프롬프트입니다.
#     문제와 보기(text) 그리고 핵심 키워드(keyword)를 입력으로 받아 출력 형식에 맞춰 결과를 생성합니다.
#     """
#     return f"""
#     당신은 금융과 경제 분야의 전문가입니다. 아래 제시된 문제와 핵심 키워드를 참고하여,
#     - 문제를 푸는 데 도움이 되는 금융·경제 지식 중심의 힌트를 2문장 이내로 제시하고,
#     - 핵심 키워드에 대한 간결한 개념 설명을 1~2문장으로 작성하세요.

# [문제]
# {text}

# [출력 형식]
# [힌트: 문제를 푸는 데 도움이 되는 간단한 힌트]
# [핵심 키워드 : 간단한 개념 설명]

# 힌트와 설명은 반드시 금융 또는 경제 지식에 기반하여 작성하세요.
# """.strip()
